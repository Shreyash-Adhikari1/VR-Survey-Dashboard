{% extends 'dashboard/base.html' %}

{% block title %}Generic Dashboard{% endblock %}

{% block header %}Generic Survey Insights{% endblock %}

{% block content %}
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- Average Answers Bar Chart -->
    <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Overall Survey Statistics</h2>
        {% if error %}
            <p class="text-red-500">{{ error }}</p>
        {% else %}
            <p class="mb-4 text-gray-600">Total Responses: <span class="font-bold">{{ total_responses }}</span></p>
            <div class="chart-container" style="width: 600px; height: 400px;">
                <canvas id="genericChart" style="width: 600px; height: 400px;"></canvas>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const ctx = document.getElementById('genericChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: [{% for qid in averages.keys %}'{{ qid }}',{% endfor %}],
                            datasets: [{
                                label: 'Average Score',
                                data: [{% for score in averages.values %}{{ score|floatformat:2 }},{% endfor %}],
                                backgroundColor: ['#4B9CE2', '#6BCB77', '#FFB6C1', '#FFD700'],
                                borderColor: ['#2A6F97', '#3E8E41', '#C77E8C', '#C9A62C'],
                                borderWidth: 1,
                                barThickness: 20
                            }]
                        },
                        options: {
                            responsive: false,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 5,
                                    title: { display: true, text: 'Score (0-5)' }
                                },
                                x: {
                                    title: { display: true, text: 'Questions' }
                                }
                            },
                            plugins: {
                                legend: { position: 'top' },
                                tooltip: { mode: 'index', intersect: false }
                            }
                        }
                    });
                });
            </script>
        {% endif %}
    </div>

    <!-- Average Answers Pie Chart -->
    <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Average Answers Distribution</h2>
        <div class="chart-container" style="width: 600px; height: 400px;">
            <canvas id="averagePieChart" style="width: 600px; height: 400px;"></canvas>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const ctx = document.getElementById('averagePieChart').getContext('2d');
                new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: [{% for qid in averages.keys %}'{{ qid }}',{% endfor %}],
                        datasets: [{
                            data: [{% for score in averages.values %}{{ score|floatformat:2 }},{% endfor %}],
                            backgroundColor: ['#4B9CE2', '#6BCB77', '#FFB6C1', '#FFD700'],
                            borderColor: ['#2A6F97', '#3E8E41', '#C77E8C', '#C9A62C'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: false,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'right' },
                            tooltip: { mode: 'point' }
                        }
                    }
                });
            });
        </script>
    </div>

    <!-- Field Suitability Bar Chart -->
    <div class="bg-white p-6 rounded-lg shadow-md col-span-2">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Field Suitability Distribution</h2>
        <p class="mb-4 text-gray-600">*Courses with low representation (e.g., <5 students) may need rethinking.</p>
        <div class="chart-container" style="width: 600px; height: 400px;">
            <canvas id="fieldChart" style="width: 600px; height: 400px;"></canvas>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const ctx = document.getElementById('fieldChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Computing', 'Ethical Hacking', 'Computing with AI'],
                        datasets: [{
                            label: 'Number of Students',
                            data: [{{ field_counts.Computing }}, {{ field_counts.Ethical_Hacking }}, {{ field_counts.Computing_with_AI }}],
                            backgroundColor: ['#4B9CE2', '#6BCB77', '#FFB6C1'],
                            borderColor: ['#2A6F97', '#3E8E41', '#C77E8C'],
                            borderWidth: 1,
                            barThickness: 30
                        }]
                    },
                    options: {
                        responsive: false,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: { display: true, text: 'Number of Students' }
                            },
                            x: {
                                title: { display: true, text: 'Fields' }
                            }
                        },
                        plugins: {
                            legend: { position: 'top' },
                            tooltip: { mode: 'index', intersect: false }
                        }
                    }
                });
            });
        </script>
    </div>
</div>
{% endblock %}