<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Survey Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        body { padding: 20px; }
        .chart-container { margin: 20px 0; }
        canvas { max-width: 600px; margin: 0 auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Survey Analytics</h1>
        <h3 class="text-center mb-4">Total Responses: {{ total_responses }}</h3>

        <h2>Survey Questions (Q1–Q25)</h2>
        {% for q, data in survey_chart_data.items %}
        <div class="chart-container">
            <h4>{{ q|title }}</h4>
            <canvas id="{{ q }}-chart"></canvas>
            <script>
                new Chart(document.getElementById('{{ q }}-chart'), {
                    type: '{{ data.type }}',
                    data: {
                        labels: {{ data.labels|safe }},
                        datasets: [{
                            data: {{ data.values|safe }},
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'],
                            borderColor: '#fff',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        plugins: {
                            legend: { display: {{ data.legend_display|lower }} },
                            title: { display: true, text: '{{ q|title }} Distribution' }
                        },
                        scales: {{ data.scales|safe }}
                    }
                });
            </script>
        </div>
        {% endfor %}

        <h2>Quiz Questions (Q6–Q15, Q26–Q30)</h2>
        {% for q, data in quiz_chart_data.items %}
        <div class="chart-container">
            <h4>{{ q|title }}</h4>
            <canvas id="{{ q }}-quiz-chart"></canvas>
            <script>
                new Chart(document.getElementById('{{ q }}-quiz-chart'), {
                    type: 'bar',
                    data: {
                        labels: {{ data.labels|safe }},
                        datasets: [{
                            data: {{ data.values|safe }},
                            backgroundColor: '#36A2EB',
                            borderColor: '#fff',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        plugins: {
                            legend: { display: false },
                            title: { display: true, text: '{{ q|title }} Answer Distribution' }
                        },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Percentage (%)' } }
                        }
                    }
                });
            </script>
        </div>
        {% endfor %}

        <h2>Correctness Across Quiz Questions</h2>
        <div class="chart-container">
            <canvas id="correctness-chart"></canvas>
            <script>
                new Chart(document.getElementById('correctness-chart'), {
                    type: 'line',
                    data: {
                        labels: {{ correctness_chart_data.labels|safe }},
                        datasets: [{
                            label: 'Correctness (%)',
                            data: {{ correctness_chart_data.values|safe }},
                            borderColor: '#FF6384',
                            fill: false
                        }]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Correctness by Question' } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Correctness (%)' } }
                        }
                    }
                });
            </script>
        </div>

        <h2>Skipped vs Non-Skipped Correctness</h2>
        <div class="chart-container">
            <canvas id="skipped-correctness-chart"></canvas>
            <script>
                new Chart(document.getElementById('skipped-correctness-chart'), {
                    type: 'bar',
                    data: {
                        labels: {{ skipped_correctness_chart_data.labels|safe }},
                        datasets: [
                            {
                                label: 'Skipped',
                                data: {{ skipped_correctness_chart_data.skipped|safe }},
                                backgroundColor: '#FF6384'
                            },
                            {
                                label: 'Not Skipped',
                                data: {{ skipped_correctness_chart_data.not_skipped|safe }},
                                backgroundColor: '#36A2EB'
                            }
                        ]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Correctness: Skipped vs Not Skipped' } },
                        scales: {
                            y: { beginAtZero: true, title: { display: true, text: 'Correctness (%)' } }
                        }
                    }
                });
            </script>
        </div>

        <h2>Recommendation Distribution</h2>
        <div class="chart-container">
            <canvas id="recommendation-pie"></canvas>
            <script>
                new Chart(document.getElementById('recommendation-pie'), {
                    type: 'pie',
                    data: {
                        labels: {{ recommendation_pie_data.labels|safe }},
                        datasets: [{
                            data: {{ recommendation_pie_data.values|safe }},
                            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56']
                        }]
                    },
                    options: {
                        plugins: { title: { display: true, text: 'Course Recommendation Distribution' } }
                    }
                });
            </script>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>