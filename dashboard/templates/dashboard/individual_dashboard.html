{% extends 'dashboard/base.html' %}

{% block title %}Individual Dashboard{% endblock %}

{% block header %}Individual Survey Details{% endblock %}

{% block content %}
<div class="space-y-6">
    <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-xl font-semibold mb-4 text-gray-700">Student Survey Lookup</h2>
        <form method="GET" class="flex space-x-4 items-end">
            <div>
                <label for="player_id" class="block text-sm font-medium text-gray-700">Enter Student ID:</label>
                <input type="text" name="player_id" id="player_id" class="mt-1 p-3 border rounded-lg w-full md:w-80 focus:ring-2 focus:ring-blue-500" value="{{ player_id|default:'student123' }}" required>
            </div>
            <button type="submit" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">Fetch Data</button>
        </form>
    </div>

    {% if error %}
        <div class="bg-white p-6 rounded-lg shadow-md">
            <p class="text-red-500">{{ error }}</p>
        </div>
    {% elif player_id %}
        <div class="bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4 text-gray-700">Student Survey Results</h2>
            <p class="mb-4 text-gray-600">Student ID: <span class="font-bold">{{ player_id }}</span></p>
            <p class="mb-4 text-gray-600">Recommended Department: <span class="font-bold">{{ recommendation|default:'N/A' }}</span></p>
            <div class="chart-container" style="width: 600px; height: 400px;">
                <canvas id="individualChart" style="width: 600px; height: 400px;"></canvas>
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const ctx = document.getElementById('individualChart').getContext('2d');
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: [{% for qid in responses.keys %}'{{ qid }}',{% endfor %}, 'Suitability'],
                            datasets: [{
                                label: 'Score',
                                data: [{% for score in responses.values %}{{ score }},{% endfor %}, {% if recommendation == 'Computing' %}4{% elif recommendation == 'Ethical Hacking' %}3{% elif recommendation == 'Computing with AI' %}5{% else %}0{% endif %}],
                                backgroundColor: ['#4B9CE2', '#6BCB77', '#FFB6C1', '#FFD700', '#FF6347'],
                                borderColor: ['#2A6F97', '#3E8E41', '#C77E8C', '#C9A62C', '#A93226'],
                                borderWidth: 1,
                                barThickness: 20
                            }]
                        },
                        options: {
                            responsive: false,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 5,
                                    title: { display: true, text: 'Score (0-5)' }
                                },
                                x: {
                                    title: { display: true, text: 'Questions & Suitability' }
                                }
                            },
                            plugins: {
                                legend: { position: 'top' },
                                tooltip: { mode: 'index', intersect: false }
                            }
                        }
                    });
                });
            </script>
        </div>
    {% endif %}
</div>
{% endblock %}